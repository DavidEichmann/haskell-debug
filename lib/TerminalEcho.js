"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const net = require("net");
const os = require("os");
const readline = require("readline");
const PIPE_NAME = "haskell-debug";
var connectionPath = os.platform() == "win32" ?
    "\\\\.\\pipe\\" + PIPE_NAME : `/tmp/${PIPE_NAME}.sock`;
var client = net.connect(connectionPath);
const rl = readline.createInterface({
    input: process.stdin
});
var ignoreOutput = false;
rl.on("line", (text) => {
    if (ignoreOutput) {
        ignoreOutput = false;
        return;
    }
    client.write(text + "\n");
});
var totalData = "";
client.on("data", (data) => {
    onData(data.toString());
});
function onData(data) {
    var newLinePos = data.indexOf("\n");
    if (newLinePos != -1) {
        totalData += data.slice(0, newLinePos);
        onMessage(JSON.parse(totalData));
        totalData = "";
        onData(data.slice(newLinePos + 1));
    }
    else {
        totalData += data;
    }
}
function onMessage(message) {
    if (message.type == "message") {
        process.stdout.write(message.content);
    }
    else if (message.type == "display-command") {
        process.stdout.write(message.command + "\n");
        ignoreOutput = true;
        rl.write("\n");
    }
    else if (message.type == "destroy-prompt") {
        rl.close();
    }
    else if (message.type == "close") {
        process.exit();
    }
    else {
        rl.prompt();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVybWluYWxFY2hvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xpYi9UZXJtaW5hbEVjaG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQkFBNEI7QUFDNUIseUJBQTBCO0FBQzFCLHFDQUFzQztBQWdCdEMsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFDO0FBRWxDLElBQUksY0FBYyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsSUFBSSxPQUFPO0lBQ3pDLGVBQWUsR0FBRyxTQUFTLEdBQUcsUUFBUSxTQUFTLE9BQU8sQ0FBQztBQUMzRCxJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFDO0FBRXpDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUM7SUFDaEMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO0NBQ3ZCLENBQUMsQ0FBQztBQUVILElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQztBQUV6QixFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQVk7SUFDdkIsRUFBRSxDQUFBLENBQUMsWUFBWSxDQUFDLENBQUEsQ0FBQztRQUNiLFlBQVksR0FBRyxLQUFLLENBQUM7UUFDckIsTUFBTSxDQUFDO0lBQ1gsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQzlCLENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFDO0FBQ25CLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBWTtJQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7QUFDNUIsQ0FBQyxDQUFDLENBQUE7QUFFRixnQkFBZ0IsSUFBWTtJQUN4QixJQUFJLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ3BDLEVBQUUsQ0FBQSxDQUFDLFVBQVUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUM7UUFDakIsU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBQ3ZDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDakMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ3ZDLENBQUM7SUFDRCxJQUFJLENBQUEsQ0FBQztRQUNELFNBQVMsSUFBSSxJQUFJLENBQUM7SUFDdEIsQ0FBQztBQUNMLENBQUM7QUFFRCxtQkFBbUIsT0FBZ0I7SUFDL0IsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxTQUFTLENBQUMsQ0FBQSxDQUFDO1FBQzFCLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUMxQyxDQUFDO0lBQ0QsSUFBSSxDQUFDLEVBQUUsQ0FBQSxDQUFDLE9BQU8sQ0FBQyxJQUFJLElBQUksaUJBQWlCLENBQUMsQ0FBQSxDQUFDO1FBQ3ZDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFDN0MsWUFBWSxHQUFHLElBQUksQ0FBQztRQUNwQixFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQ25CLENBQUM7SUFDRCxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxnQkFBZ0IsQ0FBQyxDQUFBLENBQUM7UUFDdEMsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ2YsQ0FBQztJQUNELElBQUksQ0FBQyxFQUFFLENBQUEsQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQyxDQUFBLENBQUM7UUFDN0IsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ25CLENBQUM7SUFDRCxJQUFJLENBQUEsQ0FBQztRQUNELEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQztJQUNoQixDQUFDO0FBQ0wsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBuZXQgPSByZXF1aXJlKFwibmV0XCIpO1xuaW1wb3J0IG9zID0gcmVxdWlyZShcIm9zXCIpO1xuaW1wb3J0IHJlYWRsaW5lID0gcmVxdWlyZShcInJlYWRsaW5lXCIpO1xuXG50eXBlIE1lc3NhZ2UgPSB7XG4gICAgdHlwZTogXCJtZXNzYWdlXCI7XG4gICAgY29udGVudDogc3RyaW5nXG59IHwge1xuICAgIHR5cGU6IFwidXNlcl9pbnB1dFwiO1xufSB8IHtcbiAgICB0eXBlOiBcImRlc3Ryb3ktcHJvbXB0XCI7XG59IHwge1xuICAgIHR5cGU6IFwiZGlzcGxheS1jb21tYW5kXCI7XG4gICAgY29tbWFuZDogc3RyaW5nO1xufSB8IHtcbiAgICB0eXBlOiBcImNsb3NlXCI7XG59XG5cbmNvbnN0IFBJUEVfTkFNRSA9IFwiaGFza2VsbC1kZWJ1Z1wiO1xuXG52YXIgY29ubmVjdGlvblBhdGggPSBvcy5wbGF0Zm9ybSgpID09IFwid2luMzJcIiA/XG4gICAgXCJcXFxcXFxcXC5cXFxccGlwZVxcXFxcIiArIFBJUEVfTkFNRSA6IGAvdG1wLyR7UElQRV9OQU1FfS5zb2NrYDtcbnZhciBjbGllbnQgPSBuZXQuY29ubmVjdChjb25uZWN0aW9uUGF0aCk7XG5cbmNvbnN0IHJsID0gcmVhZGxpbmUuY3JlYXRlSW50ZXJmYWNlKHtcbiAgICBpbnB1dDogcHJvY2Vzcy5zdGRpblxufSk7XG5cbnZhciBpZ25vcmVPdXRwdXQgPSBmYWxzZTtcblxucmwub24oXCJsaW5lXCIsICh0ZXh0OiBzdHJpbmcpID0+IHtcbiAgICBpZihpZ25vcmVPdXRwdXQpe1xuICAgICAgICBpZ25vcmVPdXRwdXQgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjbGllbnQud3JpdGUodGV4dCArIFwiXFxuXCIpO1xufSlcblxudmFyIHRvdGFsRGF0YSA9IFwiXCI7XG5jbGllbnQub24oXCJkYXRhXCIsIChkYXRhOiBCdWZmZXIpID0+IHtcbiAgICBvbkRhdGEoZGF0YS50b1N0cmluZygpKTtcbn0pXG5cbmZ1bmN0aW9uIG9uRGF0YShkYXRhOiBzdHJpbmcpe1xuICAgIHZhciBuZXdMaW5lUG9zID0gZGF0YS5pbmRleE9mKFwiXFxuXCIpO1xuICAgIGlmKG5ld0xpbmVQb3MgIT0gLTEpe1xuICAgICAgICB0b3RhbERhdGEgKz0gZGF0YS5zbGljZSgwLCBuZXdMaW5lUG9zKTtcbiAgICAgICAgb25NZXNzYWdlKEpTT04ucGFyc2UodG90YWxEYXRhKSk7XG4gICAgICAgIHRvdGFsRGF0YSA9IFwiXCI7XG4gICAgICAgIG9uRGF0YShkYXRhLnNsaWNlKG5ld0xpbmVQb3MgKyAxKSk7XG4gICAgfVxuICAgIGVsc2V7XG4gICAgICAgIHRvdGFsRGF0YSArPSBkYXRhO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gb25NZXNzYWdlKG1lc3NhZ2U6IE1lc3NhZ2Upe1xuICAgIGlmKG1lc3NhZ2UudHlwZSA9PSBcIm1lc3NhZ2VcIil7XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG1lc3NhZ2UuY29udGVudCk7XG4gICAgfVxuICAgIGVsc2UgaWYobWVzc2FnZS50eXBlID09IFwiZGlzcGxheS1jb21tYW5kXCIpe1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShtZXNzYWdlLmNvbW1hbmQgKyBcIlxcblwiKTtcbiAgICAgICAgaWdub3JlT3V0cHV0ID0gdHJ1ZTtcbiAgICAgICAgcmwud3JpdGUoXCJcXG5cIik7XG4gICAgfVxuICAgIGVsc2UgaWYobWVzc2FnZS50eXBlID09IFwiZGVzdHJveS1wcm9tcHRcIil7XG4gICAgICAgIHJsLmNsb3NlKCk7XG4gICAgfVxuICAgIGVsc2UgaWYobWVzc2FnZS50eXBlID09IFwiY2xvc2VcIil7XG4gICAgICAgIHByb2Nlc3MuZXhpdCgpO1xuICAgIH1cbiAgICBlbHNle1xuICAgICAgICBybC5wcm9tcHQoKTtcbiAgICB9XG59XG4iXX0=