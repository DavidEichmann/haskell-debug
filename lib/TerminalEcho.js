"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const net = require("net");
const os = require("os");
const readline = require("readline");
const PIPE_NAME = 'haskell-debug';
const connectionPath = os.platform() === 'win32' ?
    '\\\\.\\pipe\\' + PIPE_NAME : `/tmp/${PIPE_NAME}.sock`;
const client = net.connect(connectionPath);
const rl = readline.createInterface({
    input: process.stdin
});
let ignoreOutput = false;
rl.on('line', (text) => {
    if (ignoreOutput) {
        ignoreOutput = false;
        return;
    }
    client.write(text + '\n');
});
let totalData = '';
client.on('data', (data) => {
    onData(data.toString());
});
function onData(data) {
    const newLinePos = data.indexOf('\n');
    if (newLinePos !== -1) {
        totalData += data.slice(0, newLinePos);
        onMessage(JSON.parse(totalData));
        totalData = '';
        onData(data.slice(newLinePos + 1));
    }
    else {
        totalData += data;
    }
}
function onMessage(message) {
    if (message.type === 'message') {
        process.stdout.write(message.content);
    }
    else if (message.type === 'display-command') {
        process.stdout.write(message.command + '\n');
        ignoreOutput = true;
        rl.write('\n');
    }
    else if (message.type === 'destroy-prompt') {
        rl.close();
    }
    else if (message.type === 'close') {
        process.exit();
    }
    else {
        rl.prompt();
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiVGVybWluYWxFY2hvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2xpYi9UZXJtaW5hbEVjaG8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSwyQkFBMkI7QUFDM0IseUJBQXlCO0FBQ3pCLHFDQUFxQztBQWdCckMsTUFBTSxTQUFTLEdBQUcsZUFBZSxDQUFBO0FBRWpDLE1BQU0sY0FBYyxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsS0FBSyxPQUFPO0lBQzVDLGVBQWUsR0FBRyxTQUFTLEdBQUcsUUFBUSxTQUFTLE9BQU8sQ0FBQTtBQUMxRCxNQUFNLE1BQU0sR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBRTFDLE1BQU0sRUFBRSxHQUFHLFFBQVEsQ0FBQyxlQUFlLENBQUM7SUFDaEMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFLO0NBQ3ZCLENBQUMsQ0FBQTtBQUVGLElBQUksWUFBWSxHQUFHLEtBQUssQ0FBQTtBQUV4QixFQUFFLENBQUMsRUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDLElBQVk7SUFDdkIsRUFBRSxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQztRQUNmLFlBQVksR0FBRyxLQUFLLENBQUE7UUFDcEIsTUFBTSxDQUFBO0lBQ1YsQ0FBQztJQUNELE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFBO0FBQzdCLENBQUMsQ0FBQyxDQUFBO0FBRUYsSUFBSSxTQUFTLEdBQUcsRUFBRSxDQUFBO0FBQ2xCLE1BQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBWTtJQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUE7QUFDM0IsQ0FBQyxDQUFDLENBQUE7QUFFRixnQkFBaUIsSUFBWTtJQUN6QixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ3JDLEVBQUUsQ0FBQyxDQUFDLFVBQVUsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEIsU0FBUyxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFBO1FBQ3RDLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUE7UUFDaEMsU0FBUyxHQUFHLEVBQUUsQ0FBQTtRQUNkLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFBO0lBQ3RDLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNKLFNBQVMsSUFBSSxJQUFJLENBQUE7SUFDckIsQ0FBQztBQUNMLENBQUM7QUFFRCxtQkFBb0IsT0FBZ0I7SUFDaEMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxTQUFTLENBQUMsQ0FBQyxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUN6QyxDQUFDO0lBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLEtBQUssaUJBQWlCLENBQUMsQ0FBQyxDQUFDO1FBQzVDLE9BQU8sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDLENBQUE7UUFDNUMsWUFBWSxHQUFHLElBQUksQ0FBQTtRQUNuQixFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2xCLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksS0FBSyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUM7UUFDM0MsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFBO0lBQ2QsQ0FBQztJQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxLQUFLLE9BQU8sQ0FBQyxDQUFDLENBQUM7UUFDbEMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFBO0lBQ2xCLENBQUM7SUFBQyxJQUFJLENBQUMsQ0FBQztRQUNKLEVBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtJQUNmLENBQUM7QUFDTCxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5ldCA9IHJlcXVpcmUoJ25ldCcpXG5pbXBvcnQgb3MgPSByZXF1aXJlKCdvcycpXG5pbXBvcnQgcmVhZGxpbmUgPSByZXF1aXJlKCdyZWFkbGluZScpXG5cbnR5cGUgTWVzc2FnZSA9IHtcbiAgICB0eXBlOiAnbWVzc2FnZSc7XG4gICAgY29udGVudDogc3RyaW5nXG59IHwge1xuICAgIHR5cGU6ICd1c2VyX2lucHV0Jztcbn0gfCB7XG4gICAgdHlwZTogJ2Rlc3Ryb3ktcHJvbXB0Jztcbn0gfCB7XG4gICAgdHlwZTogJ2Rpc3BsYXktY29tbWFuZCc7XG4gICAgY29tbWFuZDogc3RyaW5nO1xufSB8IHtcbiAgICB0eXBlOiAnY2xvc2UnO1xufVxuXG5jb25zdCBQSVBFX05BTUUgPSAnaGFza2VsbC1kZWJ1ZydcblxuY29uc3QgY29ubmVjdGlvblBhdGggPSBvcy5wbGF0Zm9ybSgpID09PSAnd2luMzInID9cbiAgICAnXFxcXFxcXFwuXFxcXHBpcGVcXFxcJyArIFBJUEVfTkFNRSA6IGAvdG1wLyR7UElQRV9OQU1FfS5zb2NrYFxuY29uc3QgY2xpZW50ID0gbmV0LmNvbm5lY3QoY29ubmVjdGlvblBhdGgpXG5cbmNvbnN0IHJsID0gcmVhZGxpbmUuY3JlYXRlSW50ZXJmYWNlKHtcbiAgICBpbnB1dDogcHJvY2Vzcy5zdGRpblxufSlcblxubGV0IGlnbm9yZU91dHB1dCA9IGZhbHNlXG5cbnJsLm9uKCdsaW5lJywgKHRleHQ6IHN0cmluZykgPT4ge1xuICAgIGlmIChpZ25vcmVPdXRwdXQpIHtcbiAgICAgICAgaWdub3JlT3V0cHV0ID0gZmFsc2VcbiAgICAgICAgcmV0dXJuXG4gICAgfVxuICAgIGNsaWVudC53cml0ZSh0ZXh0ICsgJ1xcbicpXG59KVxuXG5sZXQgdG90YWxEYXRhID0gJydcbmNsaWVudC5vbignZGF0YScsIChkYXRhOiBCdWZmZXIpID0+IHtcbiAgICBvbkRhdGEoZGF0YS50b1N0cmluZygpKVxufSlcblxuZnVuY3Rpb24gb25EYXRhIChkYXRhOiBzdHJpbmcpIHtcbiAgICBjb25zdCBuZXdMaW5lUG9zID0gZGF0YS5pbmRleE9mKCdcXG4nKVxuICAgIGlmIChuZXdMaW5lUG9zICE9PSAtMSkge1xuICAgICAgICB0b3RhbERhdGEgKz0gZGF0YS5zbGljZSgwLCBuZXdMaW5lUG9zKVxuICAgICAgICBvbk1lc3NhZ2UoSlNPTi5wYXJzZSh0b3RhbERhdGEpKVxuICAgICAgICB0b3RhbERhdGEgPSAnJ1xuICAgICAgICBvbkRhdGEoZGF0YS5zbGljZShuZXdMaW5lUG9zICsgMSkpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgdG90YWxEYXRhICs9IGRhdGFcbiAgICB9XG59XG5cbmZ1bmN0aW9uIG9uTWVzc2FnZSAobWVzc2FnZTogTWVzc2FnZSkge1xuICAgIGlmIChtZXNzYWdlLnR5cGUgPT09ICdtZXNzYWdlJykge1xuICAgICAgICBwcm9jZXNzLnN0ZG91dC53cml0ZShtZXNzYWdlLmNvbnRlbnQpXG4gICAgfSBlbHNlIGlmIChtZXNzYWdlLnR5cGUgPT09ICdkaXNwbGF5LWNvbW1hbmQnKSB7XG4gICAgICAgIHByb2Nlc3Muc3Rkb3V0LndyaXRlKG1lc3NhZ2UuY29tbWFuZCArICdcXG4nKVxuICAgICAgICBpZ25vcmVPdXRwdXQgPSB0cnVlXG4gICAgICAgIHJsLndyaXRlKCdcXG4nKVxuICAgIH0gZWxzZSBpZiAobWVzc2FnZS50eXBlID09PSAnZGVzdHJveS1wcm9tcHQnKSB7XG4gICAgICAgIHJsLmNsb3NlKClcbiAgICB9IGVsc2UgaWYgKG1lc3NhZ2UudHlwZSA9PT0gJ2Nsb3NlJykge1xuICAgICAgICBwcm9jZXNzLmV4aXQoKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIHJsLnByb21wdCgpXG4gICAgfVxufVxuIl19